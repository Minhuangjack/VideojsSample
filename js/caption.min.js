var $txtVideoText,$txtTextDuration,$txtTextPosition,$videoTextDialog;$(function(){function i(){$videoTextDialog.hide()}function r(n){if(!/^(\d{1,2}):([0-5]?[0-9]):[0-5]?[0-9](\.\d)?$/.test(n)){alert("顯示時間格式輸入錯誤");return}var t=n.split(":"),i=0,r=0,u=0,f=0,e=0;return n.indexOf(".")!=-1&&(f=n.substring(n.indexOf(".")+1,n.length)),u=Number(t[0]),i=Number(t[1]),r=Number(t[2]),e=u*3600+i*60+r,parseFloat(e+"."+f)}var n=$("#hdVideoData").val()==""?null:JSON.parse($("#hdVideoData").val()),t;$txtVideoText=$("#txtVideoText");$txtTextDuration=$("#txtTextDuration");$txtTextPosition=$("#txtTextPosition");$videoTextDialog=$(".video-text-dialog");t=null;$mediaPlayer=$("#mediaPlayer").mediaplayer({onTimelineChanged:function(n){$txtTextPosition.val(n.toString().toHHMMSS({showFullTime:!0}));$txtTextPosition.data("position",n)},onLoaded:function(){$mediaPlayer.setSource({videoId:n.Video_Id,sourceType:"briefing",learnerMark:!1,onComplete:function(t){n=t;StartAjax("GetVideoText",{Doc_No:n.Doc_No},function(n){if(n.Success_Mark){var i=n.Response_Data.VideoText,t=[];t.push({type:"text",data:i});$mediaPlayer.setMarker(t)}else{alert(n.Display_Message);return}},!0)}})},onMarkerReached:function(n,i,r,u){var f=$(".video-text-list"),e=f.find('.text[data-no="'+n+'"]').siblings(".reach").removeClass("reach").end().addClass("reach");t!=null&&clearTimeout(t);t=setTimeout(function(){e.removeClass("reach")},u*1e3);e.length>0&&f.stop().animate({scrollTop:f.scrollTop()+e.position().top-f.height()/2+e.height()/2},"500","swing")},learnerMark:!1});$txtTextPosition.change(function(){var t=$txtTextPosition.val().toString(),n=r(t);n&&$mediaPlayer.setPosition(n,!1)});$txtTextPosition.keypress(function(n){if(n.keyCode==13)return $txtTextPosition.change(),!1});$(".insertText").click(function(){$videoTextDialog.data("mode","insert").find(".panel-title").text("新增字幕").end().toggle(!$videoTextDialog.is(":visible"));$txtVideoText.val("");$mediaPlayer.videoControl("pause");$txtTextPosition.val($mediaPlayer.getPosition().toString().toHHMMSS({showFullTime:!0}))});$videoTextDialog.on("click",'[type="button"]',function(){var o=$(this),s=o.data("role"),u,c,f,t,l,e,h;if(s=="send"||s=="preview"){if(u=$.trim($txtVideoText.val()),f=$txtTextDuration.val(),c=$txtTextPosition.val().toString(),u===""){alert("請輸入字幕內容");$txtVideoText.focus();return}if(u.length>30){alert("字幕內容請勿輸入超過 30 個字");$txtVideoText.focus();return}if($.trim(f)==""){alert("請輸入持續顯示持間");return}if(!/^\d+\.?\d*$/.test(f)){alert("持續顯示持間只能輸入數字");return}if(t=r(c),!t)return;if(t>$mediaPlayer.getTotalSeconds()){alert("指定位置超過影片總長");return}s=="send"?(o.prop("disabled",!0),l={Doc_No:n.Doc_No,Text_Position:t,Text_Duration:f,Text_Content:u},$videoTextDialog.data("mode")=="insert"?StartAjax("NewVideoText",l,function(n){var s;if(n.Success_Mark){$(".video-text-list .nodata").hide();var c=t.toString().toHHMMSS({showFullTime:!0}),h=n.Response_Data.Data_No,r=null,e=0;$(".video-text-list .text").each(function(){var i=$(this),n=parseFloat(i.data("position"));n>t&&(n-t<e||e==0)&&(r=i,e=n-t)});s=$('<div class="list-group-item text" data-no='+h+" data-position="+t+' style="overflow: hidden"><div class="row"><div class="col-xs-7"><div><span class="text-muted position">'+c+'<\/span><\/div><\/div><div class="col-xs-5 text-right option"><a href="#" data-role="edit">編輯<\/a> <a href="#" data-role="delete">刪除<\/a><\/div><\/div><div class="content" style="-ms-word-wrap: break-word; word-wrap: break-word">'+u+"<\/div><\/div>");r==null?s.hide().appendTo(".video-text-list").css("opacity",0).slideDown(200).animate({opacity:1},{queue:!1,duration:200}):s.insertBefore(r).css("opacity",0).slideDown(200).animate({opacity:1},{queue:!1,duration:200});$mediaPlayer.addMarker({Data_No:h,Marker_Position:t,Marker_Text:u,Marker_Type:"text",Marker_Duration:f})}else alert(n.Display_Message);o.prop("disabled",!1);i()},!0):$videoTextDialog.data("mode")=="edit"&&(e=$(".video-text-list .text.active"),e.removeClass("active"),h=e.data("no"),StartAjax("ModifyVideoText",{Data_No:h,Text_Content:u,Text_Position:t,Text_Duration:f},function(n){n.Success_Mark?(e.find(".content").text(u),e.find(".position").text(t.toString().toHHMMSS({showFullTime:!0})),o.prop("disabled",!1),$mediaPlayer.modifyMarker({Data_No:h,Marker_Text:u,Marker_Position:t,Marker_Duration:f}),i()):alert(n.Display_Message)},!0))):$mediaPlayer.addMarker({Data_No:-999,Marker_Position:t,Marker_Text:u,Marker_Type:"preview",Marker_Duration:f})}else s=="cancel"&&($(".video-text-list .text.active").removeClass("active"),i())});$(".video-text-list").on("click","[data-role]",function(n){n.stopPropagation();n.preventDefault();var r=$(this),u=r.data("role"),t=r.parents(".text:first"),i=t.data("no");u==="delete"?confirm("確定刪除?")&&StartAjax("DeleteVideoText",{Data_No:i},function(n){n.Success_Mark?($mediaPlayer.deleteMarker(i),t.fadeOut(200,function(){t.remove();$(".text").length==0&&$(".nodata").show()})):alert(n.Display_Message)},!0):u==="edit"&&StartAjax("ReadVideoText",{Data_No:i},function(n){if(n.Success_Mark){var i=n.Response_Data;$mediaPlayer.setPosition(i.Text_Position,!1);$mediaPlayer.videoControl("pause");$txtTextDuration.val(i.Text_Duration);$txtTextPosition.val(i.Text_Position.toString().toHHMMSS({showFullTime:!0}));$txtVideoText.val(i.Text_Content);$videoTextDialog.data("mode","edit").find(".panel-title").text("編輯字幕").end().show();t.addClass("active")}else alert(n.Display_Message)},!0)});$(".video-text-list").on("click",".text",function(){var n=$(this),i=n.data("no"),t=n.data("position");$mediaPlayer.setPosition(t,!0)})});
/*
//# sourceMappingURL=caption.min.js.map
*/