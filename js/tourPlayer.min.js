function ToggleMemoDialog(n){n?$memoDialog.show():$memoDialog.hide()}function ToggleQuestionDialog(n){n?$questionDialog.show():$questionDialog.hide()}var $mediaPlayer,$memoDialog,$questionDialog,sourceAvailable;$(function(){function y(){var n=this;n.questions=ko.observableArray(v);n.canScroll=!0;n.canReply=ko.observable(!1);n.questionCount=ko.computed(function(){return"("+n.questions().length+")"});n.afterAddEvent=function(t){var i,u;if(n.canScroll&&t.nodeType===1&&$(t).hasClass("media")&&($(".new").removeClass("new"),$(t).addClass("new"),i=!1,!i)){r.on("scroll mousedown DOMMouseScroll mousewheel keyup",function(){r.stop()});u=$(t).offset().top;r.animate({scrollTop:u},500,function(){i=!0;r.off("scroll mousedown DOMMouseScroll mousewheel keyup")})}};n.setPosition=function(n){return $mediaPlayer.setPosition(n.Question_Position),!1};n.replyQuestionNo=ko.observable(0);n.replyQuestion=function(t){n.replyQuestionNo(t.Question_No);u.remove();u=$(c);u.insertAfter($('[data-no="'+t.Question_No+'"]').last().next());u.find("textarea").focus();var f=u.offset().top,i=!1;if(!i){r.on("scroll mousedown DOMMouseScroll mousewheel keyup",function(){r.stop()});r.animate({scrollTop:f},500,function(){i=!0;r.off("scroll mousedown DOMMouseScroll mousewheel keyup")})}return!1};n.followQuestion=function(n,t){if(t.stopPropagation&&t.stopPropagation(),!$(t.target).is(":disabled")){var i=!n.Follow_Mark();return StartAjax("SetFollowMark",{Question_No:n.Question_No,Follow_Mark:i},function(t){if(t.Success_Mark)i?n.Follow_Nos(n.Follow_Nos()+1):n.Follow_Nos(n.Follow_Nos()-1),n.Follow_Mark(i);else if(t.Display_Message!=""){alert(t.Display_Message);return}}),!1}};n.readMore=function(n,t){t.stopPropagation&&t.stopPropagation();var i=$(t.target?t.target:t.srcElement);return i.prev().html(n.Question_Content),i.remove(),!1}}function p(i){var w,k,p,r,g,c,b,d,f,tt,nt,it;if(n=i,o=i.Playlist_Mark,o?(s.prop("disabled",!0).text("已收藏"),i.Finish_Mark==!0?e.prop("disabled",!0).text("已完成"):e.prop("disabled",!1).text("完成觀看")):(s.prop("disabled",!1).text("收藏"),e.prop("disabled",!0).text("完成觀看")),w=[],i.Video_Memo!=undefined){if(r=$(".video-memo-group"),r.find(".nodata").addClass("loading-bg").text("資料載入中...").show(),r.find("*").not(".nodata").remove(),k=i.Video_Memo,k.length==0)r.find(".nodata").removeClass("loading-bg").text("沒有資料").show();else{r.find(".nodata").hide();c="";for(index in k)p=k[index],d=p.Video_Position.toString().toHHMMSS(),c+='<li class="marker" data-data-no="'+p.Data_No+'" data-position="'+p.Video_Position+'"><div class="pull-left"><span class="position" title="影片時間">'+d+'<\/span> <span class="memo">'+p.Video_Memo+'<\/span><\/div><button type="button" title="刪除筆記" data-data-no="'+p.Data_No+'" class="close delete-memo">&times;<\/button><\/li>';$(c).hide().prependTo(r).css("opacity",0).slideDown(200).animate({opacity:1},{queue:!1,duration:200})}w.push({type:"memo",data:i.Video_Memo})}if(i.Video_Text!=undefined){if(r=$(".video-text-group"),r.find(".nodata").addClass("loading-bg").text("資料載入中...").show(),r.find("*").not(".nodata").remove(),g=i.Video_Text,g.length==0)r.find(".nodata").removeClass("loading-bg").text("沒有資料").show();else{r.find(".nodata").hide();c="";for(index in g)b=g[index],d=b.Text_Position.toString().toHHMMSS(),c+='<li class="marker" data-data-no="'+b.Data_No+'" data-position="'+b.Text_Position+'"><div class="pull-left"><span class="position" title="影片時間">'+d+'<\/span> <span class="memo">'+b.Text_Content+"<\/span><\/div><\/li>";$(c).hide().prependTo(r).css("opacity",0).slideDown(200).animate({opacity:1},{queue:!1,duration:200})}w.push({type:"text",data:i.Video_Text})}for(f=0,tt=i.Question.length;f<tt;f++)i.Question[f].Follow_Mark=ko.observable(i.Question[f].Follow_Mark),i.Question[f].Follow_Nos=ko.observable(i.Question[f].Follow_Nos);if(t===undefined?(v=i.Question,t=new y,ko.applyBindings(t)):(t.canScroll=!1,t.questions(i.Question),t.canScroll=!0),t.canReply(i.Can_Reply),u.remove(),w.length>0&&$mediaPlayer.setMarker(w),i.Last_Video_Position!=0&&i.Last_Video_Position!=undefined?$(".player-message").find(".text").text("上次影片播放未結束，是否繼續觀看?").end().show():$(".player-message").hide(),$("#videosummary").find(".cola-user").text(n.Publish_Name).attr("data-user-id",n.Publish_User).end().find("#online-time").text(n.Online_Time).end().find(".summary").html(n.Doc_Summary).end().find("#last-watch-time").text(n.Last_Watch_Time).end().find("#watch-nos").text(n.Watch_Nos),$("#cmdDocTopic").click(function(){OpenProg("L10B01_BriefingPlayer.aspx?VideoId="+n.Video_Id,"L10B01")}).text(n.Doc_Topic),l.is(":visible")||l.show(),a.is(":visible")||a.show(),location.hash!==""&&(nt=location.hash.substring(1),nt.indexOf("q")==0)){try{it=parseInt(location.hash.substring(1))}catch(rt){return}h($('a[href="#question"]'),function(){$("#"+nt).addClass("new");location.hash=location.hash})}}function w(t){var i=n.Video_Id;StartAjax("FinishWatchVideo",{Video_Id:i},function(i){if(i.Success_Mark)e.prop("disabled",!0).val("已完成"),n.Finish_Mark==!1,t!=undefined&&t.onComplete!=undefined&&t.onComplete();else if(i.Display_Message!=""){alert(i.Display_Message);return}})}function b(){var t=$mediaPlayer.getPosition(),i=n.Video_Id;StartAjax("StopWatchVideo",{Video_Id:i,Last_Video_Position:t},function(n){n.Success_Mark||n.Display_Message!=""&&alert(n.Display_Message)},!1)}function h(n,t){var r=n,s=r.closest("ul:not(.dropdown-menu)"),e=s.find(".active:last a"),f=e.attr("href"),u=$(f),o,i;r.parent().hasClass("active")||(e.parent().removeClass("active"),r.parent().addClass("active"),o=r.attr("href"),i=$(o),(f==="#videomemo"||f==="#videotext")&&u.data("scroll",u.find(".panel-group").scrollTop()),u.stop().fadeOut(200,function(){u.removeClass("active");i.stop().hide().addClass("active").fadeIn(200,function(){i.data("scroll")!==undefined&&i.find(".panel-group").stop().animate({scrollTop:i.data("scroll")},200);t&&t()})}))}var n,f,i;$("form").submit(function(){return!1});$(document.body).on("dragstart contextmenu",function(){return!1});n=$("#hdVideoData").val()==""?null:JSON.parse($("#hdVideoData").val());$mediaPlayer=$("#mediaPlayer").mediaplayer({sourceType:"briefing",onPlayEnded:function(n){n||$mediaPlayer.get(0).Content.Player.SetMediaSource("http://ntestmedia.colatour.com.tw/Cola_MediaFiles/inproc/pd_notfound.mp4",0,!1);sourceAvailable=n},onLoaded:function(){n!=null&&$mediaPlayer.setSource({videoId:n.Video_Id,sourceType:"briefing",onComplete:p})},onMarkerReached:function(n,t,i){var r,u;r=i=="memo"?$(".video-memo-list"):$(".video-text-list");u=r.find('li[data-data-no="'+n+'"]').siblings(".reach").removeClass("reach").end().addClass("reach");u.length>0&&r.stop().animate({scrollTop:r.scrollTop()+u.position().top-r.height()/2+u.height()/2},"500","swing")}});$(".loading").remove();var c='<div id="replyForm"><div class="media msg reply"><div class="media-body text-right"><textarea placeholder="請輸入回覆內容" class="form-control col-lg-12" id="txtReplyContent"><\/textarea><div class="pull-left help-block"><\/div><input data-role="sendReply" type="button" value="送出" class="btn btn-primary btn-xs"/><\/div><\/div><hr class="reply"/><\/div>',u=$(c),r=$("html, body"),s=$('[data-role="subscribe"]'),e=$('[data-role="finishwatch"]'),l=$(".settings"),a=$(".tooltab"),o=!1,t,v;s.click(function(t){(t.preventDefault(),$(this).prop("disabled"))||StartAjax("SubscribeVideo",{Doc_No:n.Doc_No,Online_Time:n.Online_Time},function(n){if(!n.Success_Mark){alert(n.Display_Message);return}o=!0;$.progress.showSuccess(3e3,"已收藏");s.prop("disabled",!0).text("已收藏");e.prop("disabled",!1).text("完成觀看")})});e.click(function(n){if(n.preventDefault(),!$(this).prop("disabled")){if(!o){$.progress.showSuccess(3e3,"請先收藏影片");return}w({onComplete:function(){$.progress.showSuccess(3e3,"已設定完成觀看")}})}});$(".player-message").on("click","input[type=button]",function(){var n=$(this).data("role");n=="yes"&&$mediaPlayer.videoControl("play");n=="no"&&($mediaPlayer.videoControl("stop"),$mediaPlayer.videoControl("play"));$(".player-message").hide()});$(window).on("beforeunload",function(){mediaPlayerReady&&o==!0&&b()});$(".video-memo-group, .video-text-group").on("click","li.marker",function(){var n=parseFloat($(this).data("position"));$mediaPlayer.setPosition(n,!0)});$(document).on("click",'[data-role="tab"]',function(n){n.preventDefault();h($(this))});$(".video-memo-group").on("click",".delete-memo",function(n){var t,i;n.stopPropagation();t=$(this);t.prop("disabled",!0);i=t.data("dataNo");StartAjax("DeleteVideoMemo",{Data_No:i},function(n){n.Success_Mark?($mediaPlayer.deleteMarker(i),t.parent().fadeOut(200,function(){$(this).remove();$(".video-memo-group li:visible").length==0&&$(".video-memo-group .nodata").removeClass("loading-bg").text("沒有資料").show()})):alert(n.Display_Message)},!0)});$memoDialog=$(".video-memo-dialog");$memoDialog.on("click",'[type="button"]',function(){var r=$(this),e=r.data("role"),i,t,u;if(f===undefined&&(f=$("#txtVideoMemo")),e==="send"){if(i=$.trim(f.val()),i.length>20){f.next().text("筆記內容請勿超過 20 個字").removeClass("invisible");return}if(i.length==0){f.next().text("請輸入筆記內容").removeClass("invisible");return}r.prop("disabled",!0);t=$mediaPlayer.getPosition();u={Doc_No:n.Doc_No,Video_Position:t,Video_Memo:i};StartAjax("NewVideoMemo",u,function(n){var s;if(n.Success_Mark){$(".video-memo-group .nodata").hide();var h=t.toString().toHHMMSS(),u=n.Response_Data.Data_No,e=null,o=0;$(".video-memo-group li.marker").each(function(){var i=$(this),n=parseFloat(i.data("position"));n>t&&(n-t<o||o==0)&&(e=i,o=n-t)});s=$('<li class="marker" data-data-no="'+u+'" data-position="'+t+'"><span class="position" title="影片時間">'+h+'<\/span> <span class="memo">'+i+'<\/span><button type="button" title="刪除筆記" data-data-no="'+u+'" class="close delete-memo">&times;<\/button><\/li>');e==null?s.hide().appendTo(".video-memo-group").css("opacity",0).slideDown(200).animate({opacity:1},{queue:!1,duration:200}):s.insertBefore(e).css("opacity",0).slideDown(200).animate({opacity:1},{queue:!1,duration:200});$mediaPlayer.addMarker({Data_No:u,Marker_Position:t,Marker_Text:i,Marker_Type:"memo"})}else alert(n.Display_Message);r.prop("disabled",!1);f.val("").next().addClass("invisible");$mediaPlayer.videoControl("close-memo")},!0)}else f.val("").next().addClass("invisible"),$mediaPlayer.videoControl("close-memo")});$questionDialog=$(".video-question-dialog");$questionDialog.on("click",'[type="button"]',function(){var f=$(this),c=f.data("role"),u,s;if(i===undefined&&(i=$("#txtQuestionContent")),c==="send"){var r=$.trim(i.val()),e=r.length,o=r.match(/\n/g);if(o&&(e+=o.length),e>500){i.next().text("問題內容請勿超過 500 個字").removeClass("invisible");return}if(r.length==0){i.next().text("請輸入問題內容").removeClass("invisible");return}f.prop("disabled",!0);u=$mediaPlayer.getPosition();s={Doc_No:n.Doc_No,Question_Position:u,Question_Content:r,Reply_Question_No:0};StartAjax("NewQuestion",s,function(r){if(r.Success_Mark){$(".video-question-group .nodata").hide();var e=r.Response_Data,o=u.toString().toHHMMSS();t.questions.unshift({Doc_No:n.Doc_No,Reply_Mark:!1,Position_Text:o,Question_Position:u,Question_Content:e.c,Question_No:e.n,Input_User:e.u,Input_Name:e.a,Input_Time:e.t,User_Photo:e.p,Reply_Question_No:e.n,Follow_Mark:ko.observable(null),Follow_Nos:ko.observable(0),Top_Mark:!1});h($('a[href="#question"]'))}else alert(r.Display_Message);f.prop("disabled",!1);i.val("").next().html("");$mediaPlayer.videoControl("close-question")},!0)}else i.val("").next().html(""),$mediaPlayer.videoControl("close-question")});$(document).on("click",'[data-role="cola-user"]',function(n){n.preventDefault();var t=$(this),i=t.attr("data-user-id");OpenDialogForDisplay("/A00B_Enterprise/A00B_Q02_UserData.aspx","TitleName="+encodeURIComponent("A00B_Q02　員工資料查詢")+"&UserId="+i,2,540)});$("#cmdSendQuestion").click(function(){var f=$(this),c=f.data("role"),u,s;i===undefined&&(i=$("#txtQuestionContent"));var r=$.trim(i.val()),e=r.length,o=r.match(/\n/g);if(o&&(e+=o.length),e>500){i.next().text("問題內容請勿超過 500 個字").removeClass("invisible");return}if(r.length==0){i.next().text("請輸入問題內容").removeClass("invisible");return}f.prop("disabled",!0);u=$mediaPlayer.getPosition();s={Doc_No:n.Doc_No,Question_Position:u,Question_Content:r,Reply_Question_No:0};StartAjax("NewQuestion",s,function(r){if(r.Success_Mark){$(".video-question-group .nodata").hide();var e=r.Response_Data,o=u.toString().toHHMMSS();t.questions.unshift({Doc_No:n.Doc_No,Reply_Mark:!1,Position_Text:o,Question_Position:u,Question_Content:e.c,Question_No:e.n,Input_User:e.u,Input_Name:e.a,Input_Time:e.t,User_Photo:e.p,Reply_Question_No:e.n,Follow_Mark:ko.observable(null),Follow_Nos:ko.observable(0),Top_Mark:!1});h($('a[href="#question"]'))}else alert(r.Display_Message);f.prop("disabled",!1);i.val("").next().html("")},!0)});$(document).on("click",'[data-role="sendReply"]',function(i){var e,r,h;if(i.preventDefault(),e=$(this),e.prop("disable",!0),r=t.replyQuestionNo(),r&&r!==0){var f=$.trim($("#txtReplyContent").val()),o=f.length,s=f.match(/\n/g);if(s&&(o+=s.length),f.length===0)return alert("請輸入回覆內容"),!1;if(o>500)return alert("回覆請勿輸入超過 500 個字"),!1;h={Doc_No:n.Doc_No,Question_Position:0,Question_Content:f,Reply_Question_No:r};StartAjax("NewQuestion",h,function(i){var f,c,h,o,l,s;if(i.Success_Mark){for(f=i.Response_Data,h=0,o=0,l=t.questions().length;o<l;o++)s=t.questions()[o],s.Reply_Question_No==r&&s.Question_No>h&&(h=s.Question_No,c=o);t.questions.splice(c+1,0,{Doc_No:n.Doc_No,Reply_Mark:!0,Position_Text:"",Question_Position:0,Question_Content:f.c,Question_No:f.n,Input_User:f.u,Input_Name:f.a,Input_Time:f.t,User_Photo:f.p,Reply_Question_No:r,Follow_Mark:ko.observable(null),Follow_Nos:ko.observable(0),Top_Mark:!1});u.remove()}else alert(i.Display_Message),e.prop("disabled",!1)},!0)}});$(document).on("keyup","#txtReplyContent, #txtQuestionContent",function(){var n=$(this),t=$.trim(n.val()).length,i=n.val().match(/\n/g);i&&(t+=i.length);t>500?n.next().html('<span class="text-danger">已輸入 '+t+" 字，超過可輸入的字數 500 字<\/span>"):t>0?n.next().html("還可輸入 "+(500-t)+" 字"):n.next().html("")});$qTips=$(".question-tips");$("#txtQuestionContent").focus(function(){$qTips.is(":visible")&&$qTips.hide()}).blur(function(){var n=$(this);$.trim(n.val())===""&&$qTips.show()});$('[data-toggle="collapse"]').click(function(){var n=$($(this).data("target"));n.is(":visible")?n.stop().slideUp(200):n.stop().slideDown(200)})});
/*
//# sourceMappingURL=tourPlayer.min.js.map
*/